<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Pago</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .hidden { display: none; }
    </style>
</head>

<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container px-4">
        <a class="navbar-brand fw-bold" th:href="@{/tienda}">GameStock</a>
    </div>
</nav>

<div class="container mt-4">

    <h2 class="mb-4">Finalizar Pago</h2>

    <!-- Resumen -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-dark text-white">Resumen de Productos</div>

        <div class="card-body">
            <table class="table table-bordered text-center">
                <thead class="table-dark">
                <tr>
                    <th>Producto</th>
                    <th>Precio</th>
                    <th>Imagen</th>
                </tr>
                </thead>

                <tbody>
                <tr th:each="prod : ${carrito}">
                    <td th:text="${prod.nombre}"></td>
                    <td>S/ <span th:text="${prod.precio}"></span></td>
                    <td><img th:src="${prod.imagen}" width="70" height="70" class="rounded"></td>
                </tr>
                </tbody>
            </table>

            <h4 class="text-end mt-3">
                <strong>Total a pagar: </strong> S/
                <span class="text-success fw-bold" th:text="${total}"></span>
            </h4>
        </div>
    </div>

    <!-- Pago -->
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">Método de Pago</div>

        <div class="card-body">

            <form action="/procesarPago" method="post">

                <label class="form-label">Seleccione un método:</label>
                <select class="form-select mb-3" id="metodo" name="metodo" required>
                    <option value="">-- Selecciona --</option>
                    <option value="tarjeta">Tarjeta de Crédito/Débito</option>
                    <option value="yape">Yape</option>
                </select>

                <!-- TARJETA -->
                <div id="tarjetaBox" class="hidden border p-3 mb-3 rounded bg-light">
                    <h5>Pago con Tarjeta</h5>

                    <input type="text" maxlength="16" minlength="16"
                           class="form-control mb-2"
                           placeholder="Número de tarjeta (16 dígitos)"
                           id="tarjetaNumero">

                    <div class="row">
                        <div class="col">
                            <input type="text" maxlength="5" minlength="5"
                                   class="form-control mb-2"
                                   placeholder="MM/AA" id="tarjetaFecha">
                        </div>
                        <div class="col">
                            <input type="text" maxlength="3" minlength="3"
                                   class="form-control mb-2"
                                   placeholder="CVV" id="tarjetaCVV">
                        </div>
                    </div>
                </div>

                <!-- YAPE -->
                <div id="yapeBox" class="hidden border p-3 mb-3 rounded bg-light">
                    <h5>Pago con Yape</h5>

                    <input type="text" maxlength="9" minlength="9"
                           class="form-control mb-2"
                           placeholder="Número de celular (9 dígitos)"
                           id="yapeNumero">
                </div>

                <button type="submit" class="btn btn-success btn-lg w-100">
                    Confirmar Pago
                </button>
            </form>

        </div>
    </div>

</div>

<script>
    const metodo = document.getElementById("metodo");
    const tarjetaBox = document.getElementById("tarjetaBox");
    const yapeBox = document.getElementById("yapeBox");

    metodo.addEventListener("change", () => {
        let opcion = metodo.value;

        tarjetaBox.classList.add("hidden");
        yapeBox.classList.add("hidden");

        if (opcion === "tarjeta") {
            tarjetaBox.classList.remove("hidden");
        } else if (opcion === "yape") {
            yapeBox.classList.remove("hidden");
        }
    });
</script>

</body>
</html>
